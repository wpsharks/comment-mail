(function(b){var a={},d=b(window),c=b(document);a.onReady=function(){var i="comment_mail",s="comment-mail",k=b("."+s+"-menu-page"),l=b("."+s+"-menu-page-area"),p=b("."+s+"-menu-page-table"),m=b("."+s+"-menu-page-form"),h=b("."+s+"-menu-page-stats"),n=window[i+"_vars"],t=window[i+"_i18n"],j={search_contains:true,disable_search_threshold:10,allow_single_deselect:true},o=[],r={lineNumbers:false,matchBrackets:true,theme:"ambiance",tabSize:3,indentWithTabs:true,extraKeys:{F11:function(u){if(u.getOption("fullScreen")){u.setOption("fullScreen",false),b("#adminmenuwrap, #wpadminbar").show()}else{u.setOption("fullScreen",true),b("#adminmenuwrap, #wpadminbar").hide()}}}};l.find("[data-pmp-action]").on("click",function(w){w.preventDefault(),w.stopImmediatePropagation();var v=b(this),u=v.data();if(typeof u.pmpConfirmation!=="string"||confirm(u.pmpConfirmation)){location.href=u.pmpAction}});l.find('[data-toggle~="date-time-picker"]').datetimepicker({lang:"en",lazyInit:true,validateOnBlur:false,format:"M j, Y H:i",i18n:t.dateTimePickerI18n});l.find('[data-toggle~="other"]').on("click",function(u){u.preventDefault(),u.stopImmediatePropagation();b(b(this).data("other")).toggle()});l.find('[data-toggle~="select-all"]').on("click",function(){b(this).select()});k.find("[data-cm-mode]").each(function(){var w=b(this),u=w.data("cmMode"),v=w.data("cmHeight"),x=w.find("textarea");if(x.length!==1){return}window.CodeMirror=CodeMirror||{fromTextArea:function(){}};w.addClass("cm"),o.push(CodeMirror.fromTextArea(x[0],b.extend({},r,{mode:u}))),o[o.length-1].setSize(null,v)});var e=function(){b.each(o,function(u,v){v.refresh()})};k.find(".pmp-panels-open").on("click",function(){k.find(".pmp-panel-heading").addClass("open").next(".pmp-panel-body").addClass("open"),e()});k.find(".pmp-panels-close").on("click",function(){k.find(".pmp-panel-heading").removeClass("open").next(".pmp-panel-body").removeClass("open"),e()});k.find(".pmp-panel-heading").on("click",function(u){u.preventDefault(),u.stopImmediatePropagation();b(this).toggleClass("open").next(".pmp-panel-body").toggleClass("open"),e()});k.find(".pmp-if-change").on("change",function(){var F=b(this),A=b.trim(F.val()),C=F.closest(".pmp-panel"),H=F.closest(".pmp-if-nest"),D=C;if(H.length){D=H}var u=F.hasClass("pmp-if-value-match");var E=A!==""&&A!=="0",B=!E;var z=".pmp-if-enabled",x=".pmp-if-enabled-show",y=".pmp-if-disabled",w=".pmp-if-disabled-show";var v=function(){if(H.length){return false}return b(this).hasClass("pmp-in-if-nest")};var G=function(){if(!u){return true}return b(this).hasClass("pmp-if-value-"+A)};if(E){D.find(z+","+x).not(v).filter(G).show().css("opacity",1).find(":input").removeAttr("disabled")}else{D.find(z+","+x).not(v).css("opacity",0.2).find(":input").attr("disabled","disabled"),D.find(x).not(v).hide()}if(B){D.find(y+","+w).not(v).show().css("opacity",1).find(":input").removeAttr("disabled")}else{D.find(y+","+w).not(v).css("opacity",0.2).find(":input").attr("disabled","disabled"),D.find(w).not(v).hide()}e()}).trigger("change");p.find("> form").on("submit",function(){var y=b(this),v=y.find("#bulk-action-selector-top"),x=y.find("#bulk-action-selector-bottom"),w=v.val(),u=x.val();if(w==="reconfirm"||u==="reconfirm"){return confirm(t.bulkReconfirmConfirmation)}else{if(w==="delete"||u==="delete"){return confirm(t.bulkDeleteConfirmation)}}return true});var g={$select:m.find("> form tr.pmp-sub-form-post-id select"),$input:m.find("> form tr.pmp-sub-form-post-id input"),progress:'<img src="'+n.pluginUrl+'/client-s/images/tiny-progress-bar.gif" class="pmp-progress" />'};if(g.$select.length){g.lastId=b.trim(g.$select.val())}else{g.lastId=b.trim(g.$input.val())}g.handler=function(){var v=b(this),w={},u={};g.newId=b.trim(v.val());if(g.newId===g.lastId){return}g.lastId=g.newId;w.$lastRow=m.find("> form tr.pmp-sub-form-comment-id"),w.$lastChosenContainer=w.$lastRow.find(".chosen-container"),w.$lastInput=w.$lastRow.find(":input");if(!w.$lastRow.length||!w.$lastInput.length){return}w.$lastChosenContainer.remove(),w.$lastInput.replaceWith(b(g.progress));u[i]={sub_form_comment_id_row_via_ajax:{post_id:g.newId}},b.get(n.ajaxEndpoint,u,function(x){w.$newRow=b(x),w.$lastRow.replaceWith(w.$newRow),w.$newRow.find("select").chosen(j)})};var q={$select:m.find("> form tr.pmp-sub-form-user-id select"),$input:m.find("> form tr.pmp-sub-form-user-id input"),$progress:b('<img src="'+n.pluginUrl+'/client-s/images/tiny-progress-bar.gif" class="pmp-progress" />')};if(q.$select.length){q.lastId=b.trim(q.$select.val())}else{q.lastId=b.trim(q.$input.val())}q.handler=function(){var A=b(this),B,y,u,z,w,v,C,x={};q.newId=b.trim(A.val());if(q.newId===q.lastId){return}q.lastId=q.newId;B=m.find("> form tr.pmp-sub-form-email th"),y=m.find("> form tr.pmp-sub-form-email input"),u=m.find("> form tr.pmp-sub-form-fname input"),z=m.find("> form tr.pmp-sub-form-lname input"),w=m.find("> form tr.pmp-sub-form-insertion-ip input"),v=m.find("> form tr.pmp-sub-form-insertion-region input"),C=m.find("> form tr.pmp-sub-form-insertion-country input");if(!B.length||(y.length+u.length+z.length)<1){return}q.$progress.remove(),B.append(q.$progress);x[i]={sub_form_user_id_info_via_ajax:{user_id:q.newId}},b.get(n.ajaxEndpoint,x,function(D){y.val(D.email),u.val(D.fname),z.val(D.lname),w.val(D.ip),v.val(D.region),C.val(D.country);q.$progress.remove()})};g.$select.on("change",g.handler).chosen(j),g.$input.on("blur",g.handler);m.find("> form tr.pmp-sub-form-comment-id select").chosen(j);q.$select.on("change",q.handler).chosen(j),q.$input.on("blur",q.handler);m.find("> form tr.pmp-sub-form-status select").on("change",function(){var x=b(this),u=b.trim(x.val()),v=x.siblings(".checkbox"),w=v.find("input");if(u==="unconfirmed"){v.show()}else{w.prop("checked",false),v.hide()}}).trigger("change").chosen(j);m.find("> form tr.pmp-sub-form-deliver select").chosen(j);m.find("> form").on("submit",function(w){var v=b(this),x="",u=[];v.find(".form-required :input[required]").each(function(){var y=b(this),z=b.trim(y.val());if(typeof z==="undefined"||z==="0"||z===""){u.push(this)}});b.each(u,function(){x+=b.trim(v.find('label[for="'+this.id+'"]').text().replace(/\s+/g," "))+"\n"});if((x=b.trim(x)).length){w.preventDefault(),w.stopImmediatePropagation(),alert(x);return false}});Chart.types.Bar.extend({name:"BetterBar",initialize:function(u){Chart.types.Bar.prototype.initialize.apply(this,arguments);b.each(this.datasets,function(v,w){b.each(w.bars,function(x,y){if(u.datasets[v].percent instanceof Array){y.percent=u.datasets[v].percent[x]}})})}}),Chart.BetterBar=Chart.BetterBar||function(){};if(h.length){postboxes.save_state=postboxes.save_order=function(){};postboxes.add_postbox_toggles(window.pagenow)}var f={$selects:h.find(".pmp-stats-view select"),$buttons:h.find(".pmp-stats-view button"),progress:'<img src="'+n.pluginUrl+'/client-s/images/tiny-progress-bar.gif" class="pmp-progress" />',chartOps:{responsive:true},geoChartOps:{displayMode:"regions"}};f.handler=function(){var x=b(this),C=x.closest("form"),B=x.closest(".pmp-stats-view"),v=B.find(".pmp-note.pmp-error"),y=B.find(".pmp-progress"),z=B.find(".pmp-canvas"),A=B.data("view"),w=B.find('select[name$="\\[type\\]"]').val(),u=B.data("chart");if(u&&typeof u.destroy==="function"){u.destroy()}if(u&&typeof u.clearChart==="function"){u.clearChart()}B.data("chart",null);v.remove(),z.remove();y.remove(),B.append(y=b(f.progress));if(/(?:^|_)geo(?:_|$)/i.test(w)){b.get(n.ajaxEndpoint,C.serialize(),function(H){if(!H){return}if(typeof H.errors==="string"){B.append(b(H.errors)),y.remove();return}z=b('<div class="pmp-canvas"></div>'),B.append(z);var G=new google.visualization.DataTable(),E=H.data.shift(),D=b.extend({},f.geoChartOps,H.options),F=new google.visualization.GeoChart(z[0]);G.addColumn("string","region",E[0]);G.addColumn("number","value",E[1]);G.addColumn({type:"string",role:"tooltip"});G.addRows(H.data);F.draw(G,D),B.data("chart",F),y.remove()})}else{b.get(n.ajaxEndpoint,C.serialize(),function(F){if(!F){return}if(typeof F.errors==="string"){B.append(b(F.errors)),y.remove();return}z=b('<canvas class="pmp-canvas"></canvas>'),B.append(z);var G=z.get(0).getContext("2d"),D=b.extend({},f.chartOps,F.options),E=new Chart(G).BetterBar(F.data,D);B.data("chart",E),y.remove()})}};f.$selects.chosen(j),f.$buttons.on("click",f.handler),f.$buttons.filter("[data-auto-chart]").trigger("click");f.$selects.filter('[name$="\\[type\\]"]').on("change",function(){var w=b(this),x=w.val(),u=w.closest(".pmp-stats-view"),v=u.find("tr.pmp-stats-form-by");v.css({opacity:/(?:^|_)(?:popular_posts|geo)(?:_|$)/i.test(x)?0.2:1})}).trigger("change")};c.ready(a.onReady)})(jQuery);